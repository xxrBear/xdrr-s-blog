name: Deploy My Blog to Tencent Cloud Lighthouse ğŸš€

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-22.04

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          submodules: true # ä½¿ Git Submodules å¯ç”¨
          fetch-depth: 0 # è·å–å®Œæ•´å†å²ï¼Œé˜²æ­¢å­æ¨¡å—æ›´æ–°å¤±è´¥

      - name: æ›´æ–° Git Submodules å¹¶åˆ‡æ¢åˆ°æŒ‡å®š Tag
        run: |
          git submodule update --init --recursive --remote
          cd themes/hugo-PaperMod
          git fetch --tags
          git checkout tags/v7.0
          cd ../..

      - name: å®‰è£… Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: "0.125.7" # æŒ‡å®š Hugo ç‰ˆæœ¬
          extended: true # å¦‚æœéœ€è¦ SCSS/SASS æ”¯æŒ

      - name: ç”Ÿæˆé™æ€æ–‡ä»¶
        run: hugo -F --cleanDestinationDir

      - name: é€šè¿‡ SSH å‘é€æ–‡ä»¶
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_PASSWORD }}
          source: "/public/*"
          target: "/home/ubuntu/myblog/flow/"
